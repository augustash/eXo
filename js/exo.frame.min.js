/*
* eXo - text editor of awesomeness for Drupal
* by JaceRider and contributors. Available under the MIT license.
* See http://ashenrayne.com for more information
*
* Hallo 1.0.4 - rich text editor for jQuery UI
* by Henri Bergius and contributors. Available under the MIT license.
* See http://hallojs.org for more information
*/
(function(){!function(a){return a.exoFrame={enable:function(){return a("#exo-content").exoFrame()}},a.widget("EXO.exoFrame",{parentOps:null,$instance:null,$contentWrapper:null,$finish:null,content:null,options:{id:null,label:null,plugins:{},pluginsHallo:{}},_create:function(){return this.$instance=a("#exo-instance"),this.$contentWrapper=a("#exo-content-wrapper"),this.$finish=a("#exo-finish"),this.$sidebar=a("#exo-sidebar"),this.$finish.click(this.disable.bind(this)),this._loadCss()},_init:function(){var b,c;return this.parentOps=parent.jQuery.exo,b={$exo:this.element},this.options=a.extend(b,this.parentOps.options),this.$parent=this.parentOps.selectors.$element,this.$instance.removeAttr("class"),this.options.sidebar&&this.$instance.addClass("exo-has-sidebar"),this.$sidebar.exoSidebar(this.options),this.content=this.parentOps.content,a.event.trigger({type:"exoEnable",exo:this,time:new Date}),this.element.html(this.content),this.element.hallo({editable:!0,plugins:this.options.pluginsHallo,parentElement:this.$contentWrapper,toolbarCssClass:"exo-toolbar",toolbar:"halloToolbarFixed"}),Modernizr.draganddrop&&this.element.exoDragon(),c=Drupal.settings,Drupal.attachBehaviors(this.element,c),this.element.focus()},destroy:function(){return this.element.hallo("destroy"),this.$sidebar.exoSidebar("destroy"),Modernizr.draganddrop?this.element.exoDragon("destroy"):void 0},disable:function(b){return b.preventDefault(),this.content=this.element,a.event.trigger({type:"exoDisable",exo:this,time:new Date}),parent.jQuery.exo.content=this.content.html().replace(/(\r\n|\n|\r)/gm,""),this.element.blur(),this.$parent.exo("disable"),setTimeout(this.destroy.bind(this),1e3)},_loadCss:function(){var b,c,d,e,f;if(parent.Drupal&&parent.Drupal.settings&&parent.Drupal.settings.exoInstance&&parent.Drupal.settings.exoInstance.css){e=parent.Drupal.settings.exoInstance.css,f=[];for(b in e)d=e[b],Drupal.settings.ajaxPageState.css[d]=1,c='<link media="screen" href="'+parent.Drupal.settings.basePath+d+'" rel="stylesheet" type="text/css">',f.push(a("head").append(c));return f}}})}(jQuery)}).call(this),function(){!function(a){return a.widget("IKS.exoindent",{options:{editable:null,toolbar:null,uuid:"",document:document,buttonCssClass:null},populateToolbar:function(b){var c,d,e=this;return d=a('<div class="'+this.widgetName+'"></div>'),c=function(b,c){var f;return f=a("<span></span>"),f.hallobutton({uuid:e.options.uuid,document:e.options.document,editable:e.options.editable,label:c,command:b,icon:"outdent"===b?"fa-dedent":"icon-indent",queryState:!1,cssClass:e.options.buttonCssClass}),d.append(a("button",f))},c("indent","Indent"),c("outdent","Outdent"),d.hallobuttonset(),b.append(d)}})}(jQuery)}.call(this),function(){!function(a){return this.Drupal.behaviors.exoLink={attach:function(b){return a("#exo-link-form",b).once(function(){var b;return b=a("#exo-content"),b.exolink("linkForm",a(this))})}},a.widget("IKS.exolink",{processed:!1,options:{editable:null,toolbar:null,uuid:"",document:document,buttonCssClass:null,defaultUrl:"http://"},linkForm:function(b){var c,d;return this.form=b,this.submit=a(".exo-link-save",this.form),this.web=a("#exo-link-web",this.form),this.title=a("#exo-link-title",this.form),c=this.lastSelection.toString(),c?(this.title.val(c),this.web.focus()):this.title.focus(),d=this.lastSelection.startContainer.parentNode,d.href?(this.title.parent().hide(),this.web.val(a(d).attr("href")),this.submit.text("Update Link")):(this.web.val(this.options.defaultUrl),this.submit.text("Insert Link")),this.submit.on("click",this._linkSave.bind(this))},_linkSave:function(b){var c,d,e,f,g,h=this;return b.preventDefault(),e=this.web.val(),g=this.title.val(),this.options.editable.restoreSelection(this.lastSelection),c=a("#exo-body"),a("#exo-pane").length&&c.exoPane("destroy"),d=function(a){return new RegExp(/^\s*$/).test(a)?!0:a===h.options.defaultUrl?!0:a?!1:!0},d(e)?document.execCommand("unlink",!1,!1):void 0===this.lastSelection.startContainer.parentNode.href?this.lastSelection.collapsed?(f=a("<a href='"+e+"'>"+g+"</a>")[0],this.lastSelection.insertNode(f)):document.execCommand("createLink",null,e):this.lastSelection.startContainer.parentNode.href=e,this.options.editable.element.trigger("change"),this.options.editable.keepActivated(!1),!1},populateToolbar:function(b){var c,d,e=this;return d=a('<span class="'+this.widgetName+'"></span>'),c=function(b){var c,f,g;return g=""+e.options.uuid+"-"+b,f=a("<span></span>"),f.hallobutton({label:"Link",icon:"icon-link",editable:e.options.editable,command:null,queryState:!1,uuid:e.options.uuid,cssClass:e.options.buttonCssClass}),d.append(f),c=f,c.on("click",e._click.bind(e)),e.element.on("keyup paste change mouseup",function(){var b,d;return d=a(e.options.editable.getSelection().startContainer),b=d.prop("nodeName")?d.prop("nodeName"):d.parent().prop("nodeName"),b&&"A"===b.toUpperCase()?(a("button",c).addClass("ui-state-active"),void 0):a("button",c).removeClass("ui-state-active")})},c("A"),b.append(d),d.hallobuttonset()},_click:function(){var b,c,d,e,f,g;return this.lastSelection=this.options.editable.getSelection(),this.options.editable.keepActivated(!0),g=a(this.lastSelection.startContainer),d=g.prop("nodeName")?g.prop("nodeName"):g.parent().prop("nodeName"),d&&"A"===d.toUpperCase()&&(f=window.getSelection(),e=f.getRangeAt(0),e.selectNode(this.lastSelection.startContainer)),this.processed||(this.processed=!0,b=this.element.attr("id"),c={url:"/exo/link/ajax",event:"onload",keypress:!1,prevent:!1,wrapper:b},Drupal.ajax[b]=new Drupal.ajax(b,this.element,c)),this.element.trigger("onload"),!1}})}(jQuery)}.call(this),function(){!function(a){return a.widget("IKS.hallobutton",a.IKS.hallobutton,{_createButton:function(b,c,d,e){var f;return f=["ui-button","ui-widget","ui-state-default","ui-corner-all","ui-button-text-only",""+c+"_button"],e="fa "+e.replace("icon","fa"),a('<button id="'+b+'"        class="'+f.join(" ")+'" title="'+d+'">          <span class="ui-button-text">            <i class="'+e+'"></i>          </span>        </button>')}})}(jQuery)}.call(this),function(){!function(a){return this.Drupal.behaviors.exoDragon={attach:function(b){var c;return c=a("#exo-content"),Modernizr.draganddrop&&c.data("EXO-exoDragon")?c.exoDragon("bindDraggables",b):void 0}},a.widget("EXO.exoDragon",{$dropzones:null,content:null,_create:function(){return this.$dropzones=a("#exo-content"),this.bindDropzones(),this.bindDraggables(this.$dropzones)},bindDropzones:function(){var b=this;return this.$dropzones.attr("dropzone","copy"),this.$dropzones.off("dragenter").on("dragenter",function(a){return a.preventDefault()}),this.$dropzones.off("drop").on("drop",function(c){var d,e,f,g,h,i;return b.content?(e=c.originalEvent,g=null,document.caretRangeFromPoint?g=document.caretRangeFromPoint(e.clientX,e.clientY):e.rangeParent&&(g=document.createRange(),g.setStart(e.rangeParent,e.rangeOffset)),h=window.getSelection(),h.removeAllRanges(),h.addRange(g),b.element.get(0).focus(),document.execCommand("insertHTML",!1,'<param name="dragonDropMarker" /><br>'+b.content+"<br>"),h.removeAllRanges(),d=a('param[name="dragonDropMarker"]'),f=d.length>0,f&&(b.$draggables.filter("[dragged]",b.$dropzones).not(".exo-draggable-copy").remove(),d.remove()),b.content=null,i=Drupal.settings,Drupal.attachBehaviors(b.element,i),e.preventDefault(),c.stopPropagation(),!1):!1})},bindDraggables:function(b){var c=this;return this.$draggables=a(".exo-draggable",b),this.$draggables.length?(this.$draggables.attr("draggable","true"),this.$draggables.attr("contentEditable","false"),this.$noDrags=a(".exo-nodrag",b),this.$noDrags.attr("draggable","false"),this.$draggables.off("dragstart").on("dragstart",function(b){var d,e;return b.target instanceof HTMLElement?(e=b.originalEvent,d=e.dataTransfer,a(e.target).removeAttr("dragged"),c.content=b.target.outerHTML,d.effectAllowed="copy",a.event.trigger({type:"exoDragonInsert",dragon:c,time:new Date}),d.setData("text/html",c.content),a(e.target).attr("dragged","dragged")):b.preventDefault()})):!1}})}(jQuery)}.call(this),function(){!function(a){return Drupal.ajax.prototype.commands.exoPane=function(b,c,d){var e,f;return e=a("#exo-body"),f={ajax:b,response:c,status:d},a(e).exoPane(f),e.length?e.exoPane:void 0},Drupal.ajax.prototype.commands.exoPaneHide=function(){var b;return b=a("#exo-body"),a("#exo-pane").length?b.exoPane("destroy"):void 0},a.widget("EXO.exoPane",{paneWrapper:null,pane:null,options:{ajax:null,response:null,status:null},_create:function(){return this.element.addClass("exo-pane-active"),this.paneWrapper=a("#exo-pane-wrapper"),this.paneWrapper.click(this._clickWrapper.bind(this)),this.pane=a("#exo-pane")},_init:function(){var b=this;return this.pane.html(this.options.response.data),a(".exo-pane-close",this.pane).click(this._clickClose.bind(this)),setTimeout(function(){var a;return b.element.addClass("exo-pane-open"),a=b.options.response.settings||b.options.ajax.settings||Drupal.settings,Drupal.attachBehaviors(b.pane,a)},10)},destroy:function(){var b=this;return this.element.removeClass("exo-pane-open"),setTimeout(function(){return b.element.removeClass("exo-pane-active"),b.pane.html(""),a.Widget.prototype.destroy.call(b)},300)},_clickWrapper:function(b){return"exo-pane-wrapper"===a(b.target).attr("id")?this.destroy():void 0},_clickClose:function(a){return a.preventDefault(),this.destroy()}})}(jQuery)}.call(this),function(){!function(a){return a.widget("EXO.exoSidebar",{$exo:null,$active:null,_create:function(){var b,c,d,e;this.$exo=this.options.$exo,this.$sidebarWrapper=a("#exo-sidebar-wrapper"),d=this.options.plugins,e=[];for(c in d)b=d[c],a.isPlainObject(b)||(b={}),a.extend(b,{$exo:this.$exo}),e.push(a(this.element)[c](b));return e},_init:function(){var b,c,d,e;e=[];for(c in this.options.plugins)b=this.getPluginInstance(c),b&&(d=b.populateSidebar,a.isFunction(d)&&e.push(this.element[c]("populateSidebar",this)));return e},destroy:function(){var b;for(b in this.options.plugins)a(this.element)[b]("destroy");return this.element.html(""),this.$sidebarWrapper.removeClass("active"),a.Widget.prototype.destroy.call(this)},getPluginInstance:function(b){var c;if(c=a(this.element).data("EXO-"+b))return c;if(c=a(this.element).data(b))return c;throw new Error("Plugin "+b+" not found")},setActive:function(a){return this.$active=a,this.element.parent().addClass("active")},setInactive:function(){return this.$active=!1,this.element.parent().removeClass("active")},getActive:function(){return this.$active?this.$active:!1}}),a.widget("EXO.exoSidebarButton",{$exo:null,$sidebar:null,$content:null,loaded:!1,options:{id:this.uuid,label:null,icon:null,plugin:null},_create:function(){return this.$exo=this.options.$exo,this.$sidebar=this.options.$sidebar,this.id="exo-widget-"+this.widgetName+"-"+this.options.id,this._createButton(this.options.label,this.options.icon),a.isFunction(this.options.plugin.populateSidebarContent)?this._createContent():void 0},_createButton:function(b,c){var d;return d=["exo-button",this.id],this.$button=a('<button id="'+this.id+'"        class="'+d.join(" ")+'" title="'+b+'">          <span class="ui-button-text">            <i class="fa fa-'+c+'"></i> <span class="label">'+b+"<span>          </span>        </button>"),this.$button.appendTo(this.element).click(this._click.bind(this))},_click:function(b){var c;return b.preventDefault(),a.isFunction(this.options.plugin.populateSidebarContent)?(c=this.$sidebar.exoSidebar("getActive"),this.id===c?(a("#"+this.id,this.$sidebar).removeClass("active"),a("#"+this.id+"-content",this.$sidebar).removeClass("active"),this.$content.parent().removeClass("active"),this.$sidebar.exoSidebar("setInactive")):(c&&a("#"+c,this.$sidebar).removeClass("active"),c&&a("#"+c+"-content",this.$sidebar).parent().removeClass("active"),a("#"+this.id,this.$sidebar).addClass("active"),this.$content.parent().addClass("active"),this.$sidebar.exoSidebar("setActive",this.id),this._setContent())):void 0},_createContent:function(){var b;return b=["exo-button-content"],this.$content=a('<div id="'+this.id+'-content" class="'+b.join(" ")+'"></div>'),this.$content.appendTo(this.element).wrap('<div class="exo-button-content-wrapper" />')},_setContent:function(){var b,c,d;if(!this.loaded&&(this._showLoader(),c=this.options.plugin.widgetName,b=this.$sidebar.exoSidebar("getPluginInstance",c),b&&(d=b.populateSidebarContent,a.isFunction(d))))return this.$sidebar[c]("populateSidebarContent",this.$content,this.options),this.loaded=!0},_showLoader:function(){return this.$content.html('<div class="exo-button-content-loader"><i class="fa fa-cog fa-spin fa-large"></i></div>')}})}(jQuery)}.call(this);